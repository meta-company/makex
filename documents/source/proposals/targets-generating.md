---
status: "Draft"
---
# Proposal: Generating targets

Often times one needs to generate a list of targets from a list of items (such as paths).

Macros are a confusing (for us) way to do this currently.

A generate() function is proposed. Generate generates targets from items, and is also a target which can be depended on.
aggregate() is a another function name proposed. 

TODO: runs list?  generated target run list is run after all the dependencies. 

TODO: how do we aggregate outputs?

An example with c files:

```python
def clang_compile(target, index, item: Path):
    file_name = item.name.replace('.c', ".o")
    return target(
        name=file_name,
        requires=[
            item,
        ],
        steps=[
            execute("clang", "-o", target.path / file_name, item)
        ]
    )


C_FILES = [
    "main.c",
    "object.c",
]
# generates a target render-articles, which depends on all the targets generated by function.
# or aggregate()
generate(name="compile", items=C_FILES, function=clang_compile)

```

An example of using a static site generator to write back to the source:

```python
def article_generator(target, index, item: Path):
    name = target_hash(item)
    out = source("src/articles/published_html") / item.name.replace('.md', ".html")
    return target(
        name=name,
        steps=[
            shell(
                f"./static_web_builder/markdownrenderer.py --jinja-template src/templates/article.jinja {article} {out}"
            )
        ]
    )

# generates a target render-articles, which depends on all the targets generated by function.
generate(name="render-articles", items=ARTICLES, function=article_generator)
```
    
